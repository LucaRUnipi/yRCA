# Sock Echo Experiment
The *Sock Echo* experiment deploys, loads, and analyses the logs generated by a testbed application (obtained with [Chaos Echo](https://github.com/di-unipi-socc/chaos-echo)). 

## Sock Echo
The deployed application mirrors the topology of [Sock Shop](https://microservices-demo.github.io/), from which the name "Sock Echo".
It essentially consists of 14 interacting [Chaos Echo](https://github.com/di-unipi-socc/chaos-echo) services, configured to emulate the interactions between the services forming Sock Shop.

The [docker-compose.yml](docker-compose.yml) file is specified so as to enable configuring the failure probability of 13 out of the 14 running services.
Those services correspond to the services whose failure can cause a (cascading) failure in `edgeRouter`, which is the service acting as frontend of the application.

## The Experiment
The experiment measures the performances of our tool in determining the possible root causes for an observed failure and the explanations (namely, the failure cascades) due to which root causing failures propagated to that observed.
For this, `edgeRouter` is set to always invoke its backend services and to never fail on its own. 
The other services are instead configured to vary (a) end-user load, (b) service interaction rate, (c) failure cascade lenght, and (d) service failure rate.

## Running the Experiment
The experiment runs in two subsequent steps, namely (1) log generation and (2) root cause analysis. An additional, optional step (3) enables plotting the results.

**Step 1: Log generation**

Run the [generate_logs](https://github.com/di-unipi-socc/xfail/blob/main/data/experiments/sock-echo/generate_logs.sh) script with the command
```
./generate_logs.sh
```
This will result in the creation of a folder `generated-logs`, which will contain four sub-folders, one for each of the cases (a-d). 
Each subfolder will in turn contain multiple log files, one for each of the values considered in the corresponding case.

**Step 2: Root Cause Analysis**

Move to the [post-processing](https://github.com/di-unipi-socc/xfail/tree/main/data/experiments/sock-echo/post-processing) subfolder and run the Python [script](https://github.com/di-unipi-socc/xfail/blob/main/data/experiments/sock-echo/post-processing/explain_generated_failures.py) for explaining the 's generated failures in each of the cases (a-d)
```
cd post-processing
python3 explain_generated_failures.py
```
This will generate two files, namely `outputs.txt` and `times.csv`.
* `output.txt` contains the results of the root cause analysis enacted for each `edgeRouter`'s considered for each value of the cases (a-d).
* `times.csv` contains the average time elapsed in analysing an `edgeRouter`'s failure for each value of the cases (a-d).

**Step 3: Plot Results (Optional)**

Run the Python script [plot_results](https://github.com/di-unipi-socc/xfail/blob/main/data/experiments/sock-echo/post-processing/plot_results.py):
```
python3 plot_results.py
```
This will result in generating a folder `plots` containing a set of PDFs, displaying
* the varying number of identified root causes/explanations for each of the cases (a-d),
* the percentage of explained failures for each of the cases (a-d), and
* the varying time elapsed in explaining failures in each of the cases (a-d).
(Note: In the latter case, time is normalised in millis/MB of logs, given that generated log files have different sizes)
